---
- name: Install GavoDaCHS
  hosts: localvm

  vars_files:
    - vars.yml

  remote_user: "{{ admin_user }}"

  pre_tasks:
  - name: Install sudo
    apt:
      name: sudo
      state: present


  - name: Add user to sudoers
    lineinfile:
      path: /etc/sudoers
      line: '{{ admin_user }} ALL=(ALL:ALL) ALL'
      state: present
  become: true
  become_method: su
  become_user: root

  roles:
    - install-gavo
    - load-test-data
    - restart-and-serve